$(function () {
  $("##{rawJS newGameFormId}").submit(function (event) {
    event.preventDefault();

    var gameId = $("##{rawJS gameIdField}").val();
    var bombCount = $("##{rawJS bombCountField}").val();
    var width = $("##{rawJS widthField}").val();
    var height = $("##{rawJS heightField}").val();
    var randomSeed = $("##{rawJS randomSeedField}").val();

    // (Browsers that enforce the "required" attribute on the textarea won't see this alert)
    if (!gameId || !bombCount || !width || !height) {
      console.warn({ gameId, bombCount, width, height });
      alert("Please fill out the create new game form first.");
      return;
    }

    console.log("CREATE GAME", { gameId, bombCount, width, height, event });

    $.ajax({
      url: "@{GamesR}",
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify({
        height: parseInt(height, 10),
        width: parseInt(width, 10),
        bombCount: parseInt(bombCount, 10),
        seed: randomSeed ? parseInt(randomSeed, 10) : null,
        gameId: gameId,
      }),
      success: function (data) {
        console.info("[SUCCESS] CREATE GAME", { data });
        // RE-ROUTE TO NEW GAME
        const newUrl = "/game/" + gameId;
        console.log({ newUrl });
        window.location.assign(newUrl);
      },
      error: function (data) {
        console.error("[ERROR] CREATE GAME", { data });
      },
    });
  });
});
